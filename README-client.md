
# Alpine 远程部署助手 (Alpine Deployer)

本插件是为 `GUI.for.SingBox` 开发的扩展脚本，旨在将本地选中的配置（Profile）安全、快速地推送到远程服务器。它通过 AES 加密确保传输安全，并具备全自动的依赖管理能力。

## 🌟 核心功能

- **一键推送**：支持将当前激活的配置或指定的配置一键加密发送至远程地址。
- **全自动依赖加载**：首次运行会自动从 CDN 获取 `crypto-js` 并本地缓存，实现“开箱即用”，无需手动安装。
- **零配置支持**：除了支持通过插件界面设置参数外，还支持在代码内通过 `DEFAULT_CONFIG` 预定义配置，完全脱离界面运行。
- **AES 安全加密**：所有配置内容在发送前均进行 AES 加密，防止节点信息在传输过程中被截获或泄露。
- **双模式触发**：
  - **右键菜单**：在配置列表右键点击即可部署。
  - **插件面板**：点击运行按钮，自动识别当前激活配置或弹出选择器。

## 📂 安装方法

1. **获取代码**：将插件的 `.js` 脚本内容保存。
2. **放置路径**：进入 `GUI.for.SingBox` 的数据目录，将脚本放入 `data/plugins` 文件夹内。
3. **刷新插件**：在 GUI 的插件管理界面点击刷新，即可看到“Alpine 远程部署助手”。

## ⚙️ 插件配置

插件支持两种配置方式（**优先级：界面设置 > 代码预定义**）：

### 1. 代码预定义 (推荐)
直接修改脚本顶部的 `DEFAULT_CONFIG` 常量，适合固定服务器的用户：
```javascript
const DEFAULT_CONFIG = {
  address: 'http://你的服务器IP:8080', 
  token: '你的验证Token',           
  secret: '你的加密密钥'             
}
```

### 2. 界面设置
如果你在插件的 `metadata` 中定义了 `props`，可以在 GUI 插件设置界面填写：
- **服务器地址 (ServerAddress)**：例如 `http://192.168.1.100:8080`
- **验证令牌 (Token)**：用于服务端的 Bearer 认证。
- **加密密钥 (Secret)**：用于 AES 加密的私钥。

## 🚀 使用流程

1. **环境准备**：插件运行后会自动检查 `data/third/alpine-deployer/crypto-js.js` 是否存在。若缺失，将自动后台下载。
2. **读取配置**：插件通过调用系统 API `Plugins.generateConfig` 获取当前 Profile 的标准 Sing-Box JSON 对象。
3. **加密打包**：将 JSON 字符串通过 `CryptoJS` 进行 AES 处理。
4. **网络传输**：通过 `HttpPost` 将加密后的数据流推送到目标的 `/deploy` 接口。
5. **反馈结果**：实时显示“生成中”、“加密中”、“推送中”等状态，并返回服务端的预检结果。

## 📝 逻辑说明

- **URL 兼容性**：插件会自动处理地址末尾多余的斜杠，并自动补全 `http://` 协议头。
- **静默安装**：`loadDependence` 函数采用了 Promise 包装与轮询检测机制，确保加密库在注入环境并解析完成后才继续执行后续逻辑。
- **错误捕获**：具备完善的 `try-catch` 机制，无论是网络错误、加密失败还是服务端拒绝，都能给出清晰的中文提示。

## ⚠️ 提示

- 远程推送前，请确保你的本地配置中有针对服务器 IP 的 **直连 (Direct)** 规则，以防部署后因路由环路导致无法再次连接服务器。
- 本插件仅负责客户端的“推送”动作，需配合兼容的接收端（如基于 Node.js Express 的接收器）使用。

--- 
**版本**: 1.4.1  
**环境**: GUI.for.SingBox  
**作者**: 用户定制